# TODO: make all parameters in here settable via pillar, with a default here if not set

{% set KEY = pillar['scidbKEY'] %}
{% set VER = pillar['scidbVER'][KEY] %}

{% set my_cluster = pillar['scidb_minion_info'][grains['fqdn']]['clusterName'] %}
{% set my_hosts   = pillar['scidb_cluster_info'][my_cluster]['hosts'] %}

[test_dbname]

# SERVER LIST (TODO: make num instances overridable)
{% set n = 0 %}
{% for host_info in my_hosts %}
{{ "server-" + n|string + "=" + host_info['scidbNameAddr'] + ",15" }}
{% set n = n+1 %}
{% endfor %}

db_user=test_dbuser
install_root={{'/opt/scidb/'+VER}}
pluginsdir={{'/opt/scidb/'+VER+'/lib/scidb/plugins'}}
logconf={{'/opt/scidb/'+VER+'/share/scidb/log4cxx.properties'}}
base-port=1239
base-path=/home/scidbadmin/scidbdata

# memory
mem-array-threshold=2048
smgr-cache-size=512
merge-sort-buffer=512
sg-send-queue-size=256
sg-receive-queue-size=256

# threads
execution-threads=6
# max_concurrent_queries * threads_per_query:
result-prefetch-threads=4
# threads_per_query:
result-prefetch-queue-size=2
operator-threads=2

# these must be present before initall
# NOTE: these assume /data0 and /data1 ,i.e ginger

# TODO: reduce host to just the current host
{% for host in [0, 1, 2, 3] %}
  {# set first_half = [ 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15] #}
  {% set first_half = [ 0,1,2,3,4,5,6,7] %}
  {# set first_half = [ 0,1,2,3] #}
  {# set first_half = [ 0,1,] #}
  {# set first_half = [ 0 ] #}
  {% for inst in first_half %}
{{'data-dir-prefix-' +host|string+ '-' +inst|string+ '=/data0/' + host|string + '-' + inst|string }}
  {% endfor %}
  {# set second_half = [16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31] #}
  {% set second_half = [8,9,10,11,12,13,14,15] %}
  {# set second_half = [4,5,6,7] #}
  {# set second_half = [2,3] #}
  {# set second_half = [1] #}
  {% for inst in second_half %}
{{'data-dir-prefix-' +host|string+ '-' +inst|string+ '=/data1/' + host|string + '-' + inst|string }}
  {% endfor %}
{% endfor %}
